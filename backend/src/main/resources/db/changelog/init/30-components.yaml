databaseChangeLog:
  - changeSet:
      id: create-components-table
      author: AALEXEEN
      changes:
        - createTable:
            tableName: components
            columns:
              - column:
                  name: id
                  type: UUID
                  constraints:
                    primaryKey: true
                    nullable: false
              - column:
                  name: component_class
                  type: VARCHAR(50)
                  constraints:
                    nullable: false
              - column:
                  name: created_at
                  type: timestamp
                  defaultValueComputed: "CURRENT_TIMESTAMP"
                  constraints:
                    nullable: false
              - column:
                  name: updated_at
                  type: timestamp
                  defaultValueComputed: "CURRENT_TIMESTAMP"
                  constraints:
                    nullable: false
              - column:
                  name: name
                  type: VARCHAR(128)
                  constraints:
                    nullable: false
              - column:
                  name: description
                  type: TEXT
              - column:
                  name: manufacturer
                  type: VARCHAR(128)
                  constraints:
                    nullable: false
              - column:
                  name: model
                  type: VARCHAR(128)
              - column:
                  name: serial_number
                  type: VARCHAR(128)
                  constraints:
                    nullable: false
              - column:
                  name: part_number
                  type: VARCHAR(128)
              - column:
                  name: component_status_id
                  type: UUID
                  constraints:
                    nullable: false
              - column:
                  name: component_type_id
                  type: UUID
                  constraints:
                    nullable: false
              - column:
                  name: component_nature_id
                  type: UUID
              - column:
                  name: last_maintenance_date
                  type: TIMESTAMP
              - column:
                  name: next_maintenance_date
                  type: TIMESTAMP
              - column:
                  name: installation_id
                  type: UUID
              - column:
                  name: parent_component_id
                  type: UUID

# ============================================================
# RACK-SPECIFIC FIELDS (28 fields)
# Used when component_class = 'RACK'
# ============================================================

# Rack capacity and model reference
              # Rack capacity and model reference
              - column:
                  name: rack_units_total
                  type: INTEGER
                  constraints:
                    nullable: true

              - column:
                  name: rack_type_id
                  type: UUID
                  constraints:
                    nullable: true

              # Physical dimensions
              - column:
                  name: actual_width_inches
                  type: DOUBLE PRECISION
                  constraints:
                    nullable: true

              - column:
                  name: actual_depth_inches
                  type: DOUBLE PRECISION
                  constraints:
                    nullable: true

              - column:
                  name: actual_height_inches
                  type: DOUBLE PRECISION
                  constraints:
                    nullable: true

              # Door and panel configuration
              - column:
                  name: front_door_type
                  type: VARCHAR(32)
                  constraints:
                    nullable: true

              - column:
                  name: rear_door_type
                  type: VARCHAR(32)
                  constraints:
                    nullable: true

              - column:
                  name: has_side_panels
                  type: BOOLEAN
                  defaultValueBoolean: true
                  constraints:
                    nullable: true

              - column:
                  name: has_front_door
                  type: BOOLEAN
                  defaultValueBoolean: true
                  constraints:
                    nullable: true

              - column:
                  name: has_rear_door
                  type: BOOLEAN
                  defaultValueBoolean: true
                  constraints:
                    nullable: true

              # Power infrastructure
              - column:
                  name: power_outlets
                  type: INTEGER
                  constraints:
                    nullable: true

              - column:
                  name: power_capacity_watts
                  type: INTEGER
                  constraints:
                    nullable: true

              - column:
                  name: has_pdu
                  type: BOOLEAN
                  defaultValueBoolean: false
                  constraints:
                    nullable: true

              - column:
                  name: pdu_type
                  type: VARCHAR(64)
                  constraints:
                    nullable: true

              # Cooling configuration
              - column:
                  name: cooling_type
                  type: VARCHAR(32)
                  constraints:
                    nullable: true

              - column:
                  name: has_fans
                  type: BOOLEAN
                  defaultValueBoolean: false
                  constraints:
                    nullable: true

              - column:
                  name: fan_count
                  type: INTEGER
                  constraints:
                    nullable: true

              # Security features
              - column:
                  name: has_locks
                  type: BOOLEAN
                  defaultValueBoolean: true
                  constraints:
                    nullable: true

              - column:
                  name: lock_type
                  type: VARCHAR(32)
                  constraints:
                    nullable: true

              # Environmental monitoring
              - column:
                  name: has_temperature_monitoring
                  type: BOOLEAN
                  defaultValueBoolean: false
                  constraints:
                    nullable: true

              - column:
                  name: has_humidity_monitoring
                  type: BOOLEAN
                  defaultValueBoolean: false
                  constraints:
                    nullable: true

              - column:
                  name: has_power_monitoring
                  type: BOOLEAN
                  defaultValueBoolean: false
                  constraints:
                    nullable: true

              # Cable management
              - column:
                  name: cable_management_type
                  type: VARCHAR(64)
                  constraints:
                    nullable: true

              - column:
                  name: has_cable_trays
                  type: BOOLEAN
                  defaultValueBoolean: true
                  constraints:
                    nullable: true

              # Installation details
              - column:
                  name: is_floor_anchored
                  type: BOOLEAN
                  defaultValueBoolean: false
                  constraints:
                    nullable: true

              - column:
                  name: floor_anchor_type
                  type: VARCHAR(32)
                  constraints:
                    nullable: true

              # Weight and capacity
              - column:
                  name: empty_weight_kg
                  type: DOUBLE PRECISION
                  constraints:
                    nullable: true

              - column:
                  name: max_load_weight_kg
                  type: DOUBLE PRECISION
                  constraints:
                    nullable: true
        # Foreign key for rack_type_id
        - addForeignKeyConstraint:
            baseTableName: components
            baseColumnNames: rack_type_id
            constraintName: fk_rack_type
            referencedTableName: rack_models
            referencedColumnNames: id
            onDelete: RESTRICT

        # Index for rack_type_id
        - createIndex:
            tableName: components
            indexName: idx_component_rack_type_id
            columns:
              - column:
                  name: rack_type_id
        ### Rack section end ###

              # ============================================================
              # DEVICE-SPECIFIC FIELDS (23 fields)
              # Used when component_class IN ('NETWORK_SWITCH', 'ROUTER', 'ACCESS_POINT', 'PATCH_PANEL')
              # Base fields for all devices
              # ============================================================

              # Network management configuration
              - column:
                  name: management_ip
                  type: VARCHAR(15)
                  constraints:
                    nullable: true

              - column:
                  name: subnet_mask
                  type: VARCHAR(15)
                  constraints:
                    nullable: true

              - column:
                  name: default_gateway
                  type: VARCHAR(15)
                  constraints:
                    nullable: true

              - column:
                  name: management_vlan
                  type: INTEGER
                  constraints:
                    nullable: true

              # Firmware and software versions
              - column:
                  name: firmware_version
                  type: VARCHAR(128)
                  constraints:
                    nullable: true

              - column:
                  name: software_version
                  type: VARCHAR(128)
                  constraints:
                    nullable: true

              - column:
                  name: boot_loader_version
                  type: VARCHAR(128)
                  constraints:
                    nullable: true

              # Device credentials and SNMP
              - column:
                  name: admin_username
                  type: VARCHAR(64)
                  constraints:
                    nullable: true

              - column:
                  name: snmp_community_read
                  type: VARCHAR(128)
                  constraints:
                    nullable: true

              - column:
                  name: snmp_community_write
                  type: VARCHAR(128)
                  constraints:
                    nullable: true

              - column:
                  name: snmp_version
                  type: VARCHAR(16)
                  defaultValue: "v2c"
                  constraints:
                    nullable: true

              # Monitoring and management
              - column:
                  name: is_monitored
                  type: BOOLEAN
                  defaultValueBoolean: false
                  constraints:
                    nullable: true

              - column:
                  name: monitoring_interval_seconds
                  type: INTEGER
                  defaultValueNumeric: 300
                  constraints:
                    nullable: true

              - column:
                  name: last_ping_time
                  type: TIMESTAMP
                  constraints:
                    nullable: true

              - column:
                  name: last_ping_success
                  type: BOOLEAN
                  defaultValueBoolean: false
                  constraints:
                    nullable: true

              - column:
                  name: uptime_seconds
                  type: BIGINT
                  constraints:
                    nullable: true

              # Physical characteristics
              - column:
                  name: console_port_type
                  type: VARCHAR(32)
                  constraints:
                    nullable: true

              - column:
                  name: has_redundant_power
                  type: BOOLEAN
                  defaultValueBoolean: false
                  constraints:
                    nullable: true

              - column:
                  name: operating_temperature_min
                  type: INTEGER
                  constraints:
                    nullable: true

              - column:
                  name: operating_temperature_max
                  type: INTEGER
                  constraints:
                    nullable: true

              # Device monitoring metrics
              - column:
                  name: cpu_utilization_percent
                  type: INTEGER
                  constraints:
                    nullable: true

              - column:
                  name: memory_utilization_percent
                  type: INTEGER
                  constraints:
                    nullable: true

              - column:
                  name: temperature_celsius
                  type: INTEGER
                  constraints:
                    nullable: true

        # Indexes for frequently queried device fields
        - createIndex:
            tableName: components
            indexName: idx_component_management_ip
            columns:
              - column:
                  name: management_ip

        - createIndex:
            tableName: components
            indexName: idx_component_monitored
            columns:
              - column:
                  name: is_monitored
                  where: "is_monitored = true"
        ### Device section end ###

              # ============================================================
              # HASPORTSIMPL-SPECIFIC FIELD (1 field)
              # Used when component_class IN ('NETWORK_SWITCH', 'ROUTER', 'ACCESS_POINT', 'PATCH_PANEL')
              # Devices that have network ports
              # ============================================================

              - column:
                  name: max_throughput_gbps
                  type: DOUBLE PRECISION
                  constraints:
                    nullable: true
        ### HASPORTSIMPL section end ###

              # ============================================================
              # NETWORK_SWITCH-SPECIFIC FIELDS (21 fields)
              # Used when component_class = 'NETWORK_SWITCH'
              # ============================================================

              # Switch model reference
              - column:
                  name: switch_model_id
                  type: UUID
                  constraints:
                    nullable: true

              # Port configuration
              - column:
                  name: max_ports
                  type: INTEGER
                  constraints:
                    nullable: true

              # PoE capabilities
              - column:
                  name: supports_poe
                  type: BOOLEAN
                  defaultValueBoolean: false
                  constraints:
                    nullable: true

              - column:
                  name: poe_budget_watts
                  type: INTEGER
                  constraints:
                    nullable: true

              # Stacking capabilities
              - column:
                  name: supports_stacking
                  type: BOOLEAN
                  defaultValueBoolean: false
                  constraints:
                    nullable: true

              - column:
                  name: stack_id
                  type: INTEGER
                  constraints:
                    nullable: true

              - column:
                  name: stack_priority
                  type: INTEGER
                  constraints:
                    nullable: true

              - column:
                  name: max_stack_members
                  type: INTEGER
                  constraints:
                    nullable: true

              # Performance characteristics
              - column:
                  name: switching_capacity_gbps
                  type: DOUBLE PRECISION
                  constraints:
                    nullable: true

              - column:
                  name: forwarding_rate_mpps
                  type: DOUBLE PRECISION
                  constraints:
                    nullable: true

              - column:
                  name: mac_address_table_size
                  type: INTEGER
                  constraints:
                    nullable: true

              # VLAN support
              - column:
                  name: vlan_support
                  type: BOOLEAN
                  defaultValueBoolean: false
                  constraints:
                    nullable: true

              - column:
                  name: max_vlans
                  type: INTEGER
                  constraints:
                    nullable: true

              # Protocol support
              - column:
                  name: spanning_tree_support
                  type: BOOLEAN
                  defaultValueBoolean: false
                  constraints:
                    nullable: true

              - column:
                  name: qos_support
                  type: BOOLEAN
                  defaultValueBoolean: false
                  constraints:
                    nullable: true

              - column:
                  name: port_mirroring
                  type: BOOLEAN
                  defaultValueBoolean: false
                  constraints:
                    nullable: true

              - column:
                  name: link_aggregation
                  type: BOOLEAN
                  defaultValueBoolean: false
                  constraints:
                    nullable: true

              # VLAN configuration
              - column:
                  name: native_vlan
                  type: INTEGER
                  defaultValueNumeric: 1
                  constraints:
                    nullable: true

              - column:
                  name: voice_vlan
                  type: INTEGER
                  constraints:
                    nullable: true

              # Buffer configuration
              - column:
                  name: packet_buffer_size_mb
                  type: DOUBLE PRECISION
                  constraints:
                    nullable: true

        # Foreign key for switch_model_id
        - addForeignKeyConstraint:
            baseTableName: components
            baseColumnNames: switch_model_id
            constraintName: fk_switch_model
            referencedTableName: switch_models
            referencedColumnNames: id
            onDelete: RESTRICT

        # Indexes for switch-specific queries
        - createIndex:
            tableName: components
            indexName: idx_component_switch_model_id
            columns:
              - column:
                  name: switch_model_id

        - createIndex:
            tableName: components
            indexName: idx_component_stack_id
            columns:
              - column:
                  name: stack_id
                  where: "stack_id IS NOT NULL"
        ### Network switch section end ###

              # ============================================================
              # ROUTER-SPECIFIC FIELDS (14 fields)
              # Used when component_class = 'ROUTER'
              # ============================================================

              # Routing capacity
              - column:
                  name: max_routes
                  type: INTEGER
                  constraints:
                    nullable: true

              # Routing protocol support
              - column:
                  name: supports_bgp
                  type: BOOLEAN
                  defaultValueBoolean: false
                  constraints:
                    nullable: true

              - column:
                  name: supports_ospf
                  type: BOOLEAN
                  defaultValueBoolean: false
                  constraints:
                    nullable: true

              - column:
                  name: supports_eigrp
                  type: BOOLEAN
                  defaultValueBoolean: false
                  constraints:
                    nullable: true

              - column:
                  name: supports_rip
                  type: BOOLEAN
                  defaultValueBoolean: false
                  constraints:
                    nullable: true

              - column:
                  name: supports_static_routing
                  type: BOOLEAN
                  defaultValueBoolean: true
                  constraints:
                    nullable: true

              # NAT capabilities
              - column:
                  name: supports_nat
                  type: BOOLEAN
                  defaultValueBoolean: false
                  constraints:
                    nullable: true

              - column:
                  name: max_nat_sessions
                  type: INTEGER
                  constraints:
                    nullable: true

              # VPN capabilities
              - column:
                  name: supports_ipsec_vpn
                  type: BOOLEAN
                  defaultValueBoolean: false
                  constraints:
                    nullable: true

              - column:
                  name: max_vpn_tunnels
                  type: INTEGER
                  constraints:
                    nullable: true

              # Security features
              - column:
                  name: supports_acl
                  type: BOOLEAN
                  defaultValueBoolean: false
                  constraints:
                    nullable: true

              - column:
                  name: supports_firewall
                  type: BOOLEAN
                  defaultValueBoolean: false
                  constraints:
                    nullable: true

              # Performance metrics
              - column:
                  name: routing_throughput_gbps
                  type: DOUBLE PRECISION
                  constraints:
                    nullable: true

              - column:
                  name: packets_per_second
                  type: BIGINT
                  constraints:
                    nullable: true
        ### Router section end ###

              # ============================================================
              # ACCESS_POINT-SPECIFIC FIELDS (13 fields)
              # Used when component_class = 'ACCESS_POINT'
              # ============================================================

              # WiFi capabilities
              - column:
                  name: wifi_standard
                  type: VARCHAR(32)
                  constraints:
                    nullable: true

              - column:
                  name: max_clients
                  type: INTEGER
                  constraints:
                    nullable: true

              # Band support
              - column:
                  name: supports_dual_band
                  type: BOOLEAN
                  defaultValueBoolean: false
                  constraints:
                    nullable: true

              - column:
                  name: supports_5ghz
                  type: BOOLEAN
                  defaultValueBoolean: false
                  constraints:
                    nullable: true

              - column:
                  name: supports_6ghz
                  type: BOOLEAN
                  defaultValueBoolean: false
                  constraints:
                    nullable: true

              # Power over Ethernet
              - column:
                  name: poe_required
                  type: BOOLEAN
                  defaultValueBoolean: true
                  constraints:
                    nullable: true

              - column:
                  name: poe_consumption_watts
                  type: INTEGER
                  constraints:
                    nullable: true

              # Coverage and performance
              - column:
                  name: coverage_radius_meters
                  type: INTEGER
                  constraints:
                    nullable: true

              - column:
                  name: max_throughput_mbps
                  type: INTEGER
                  constraints:
                    nullable: true

              # Security features
              - column:
                  name: supports_wpa3
                  type: BOOLEAN
                  defaultValueBoolean: false
                  constraints:
                    nullable: true

              - column:
                  name: supports_enterprise_auth
                  type: BOOLEAN
                  defaultValueBoolean: false
                  constraints:
                    nullable: true

              # Management
              - column:
                  name: controller_managed
                  type: BOOLEAN
                  defaultValueBoolean: false
                  constraints:
                    nullable: true

              - column:
                  name: controller_ip
                  type: VARCHAR(15)
                  constraints:
                    nullable: true

        # Index for controller-managed APs
        - createIndex:
            tableName: components
            indexName: idx_component_controller_managed
            columns:
              - column:
                  name: controller_managed
              - column:
                  name: controller_ip
                  where: "controller_managed = true"
        ### Access point section end ###

              # ============================================================
              # PATCH_PANEL-SPECIFIC FIELDS (14 fields)
              # Used when component_class = 'PATCH_PANEL'
              # ============================================================

              # Patch panel model reference
              - column:
                  name: patch_panel_model_id
                  type: UUID
                  constraints:
                    nullable: true

              # Panel specifications
              - column:
                  name: panel_type
                  type: VARCHAR(64)
                  constraints:
                    nullable: true

              - column:
                  name: connector_type
                  type: VARCHAR(64)
                  constraints:
                    nullable: true

              # Rack positioning
              - column:
                  name: rack_units
                  type: INTEGER
                  constraints:
                    nullable: true

              - column:
                  name: rack_position
                  type: INTEGER
                  constraints:
                    nullable: true

              # Panel identification
              - column:
                  name: panel_label
                  type: VARCHAR(64)
                  constraints:
                    nullable: true

              - column:
                  name: port_labeling_scheme
                  type: VARCHAR(64)
                  constraints:
                    nullable: true

              # Installation configuration
              - column:
                  name: mounting_type
                  type: VARCHAR(32)
                  constraints:
                    nullable: true

              - column:
                  name: termination_type
                  type: VARCHAR(32)
                  constraints:
                    nullable: true

              # Performance characteristics
              - column:
                  name: category_rating
                  type: VARCHAR(16)
                  constraints:
                    nullable: true

              - column:
                  name: shielded
                  type: BOOLEAN
                  defaultValueBoolean: false
                  constraints:
                    nullable: true

              # Cable management
              - column:
                  name: cable_management
                  type: BOOLEAN
                  defaultValueBoolean: false
                  constraints:
                    nullable: true

              - column:
                  name: cable_management_type
                  type: VARCHAR(64)
                  constraints:
                    nullable: true

              # Documentation
              - column:
                  name: installation_notes
                  type: VARCHAR(1024)
                  constraints:
                    nullable: true

        # Foreign key for patch_panel_model_id
        - addForeignKeyConstraint:
            baseTableName: components
            baseColumnNames: patch_panel_model_id
            constraintName: fk_patch_panel_model
            referencedTableName: patch_panel_models
            referencedColumnNames: id
            onDelete: RESTRICT

        # Index for patch panel model
        - createIndex:
            tableName: components
            indexName: idx_component_patch_panel_model_id
            columns:
              - column:
                  name: patch_panel_model_id
        ### Patch panel section ends ###

              # ============================================================
              # CONNECTOR-SPECIFIC FIELDS (9 fields)
              # Used when component_class = 'CONNECTOR'
              # ============================================================

              # Connector model reference
              - column:
                  name: connector_model_id
                  type: UUID
                  constraints:
                    nullable: true

              # Connector specifications
              - column:
                  name: connector_type
                  type: VARCHAR(64)
                  constraints:
                    nullable: true

              - column:
                  name: connector_position
                  type: VARCHAR(32)
                  constraints:
                    nullable: true

              - column:
                  name: gender
                  type: VARCHAR(16)
                  constraints:
                    nullable: true

              # Physical identification
              - column:
                  name: connector_label
                  type: VARCHAR(64)
                  constraints:
                    nullable: true

              - column:
                  name: color_code
                  type: VARCHAR(16)
                  constraints:
                    nullable: true

              # Installation and condition
              - column:
                  name: termination_quality
                  type: VARCHAR(32)
                  constraints:
                    nullable: true

              - column:
                  name: installation_notes
                  type: VARCHAR(512)
                  constraints:
                    nullable: true

              # Relationship to cable run (REQUIRED for connectors)
              - column:
                  name: cable_run_id
                  type: UUID
                  constraints:
                    nullable: true

        # Foreign key for connector_model_id
        - addForeignKeyConstraint:
            baseTableName: components
            baseColumnNames: connector_model_id
            constraintName: fk_connector_model
            referencedTableName: connector_models
            referencedColumnNames: id
            onDelete: RESTRICT

        # Foreign key for cable_run_id (self-reference to components)
        - addForeignKeyConstraint:
            baseTableName: components
            baseColumnNames: cable_run_id
            constraintName: fk_connector_cable_run
            referencedTableName: components
            referencedColumnNames: id
            onDelete: CASCADE

        # Indexes
        - createIndex:
            tableName: components
            indexName: idx_component_connector_model_id
            columns:
              - column:
                  name: connector_model_id

        - createIndex:
            tableName: components
            indexName: idx_component_cable_run_id
            columns:
              - column:
                  name: cable_run_id
        ### Connector section ends ###

              # ============================================================
              # CABLE_RUN-SPECIFIC FIELDS (15 fields)
              # Used when component_class = 'CABLE_RUN'
              # ============================================================

              # Cable model reference
              - column:
                  name: cable_model_id
                  type: UUID
                  constraints:
                    nullable: true

              # Cable specifications
              - column:
                  name: cable_length_meters
                  type: DOUBLE PRECISION
                  constraints:
                    nullable: true

              - column:
                  name: cable_type
                  type: VARCHAR(64)
                  constraints:
                    nullable: true

              - column:
                  name: cable_category
                  type: VARCHAR(32)
                  constraints:
                    nullable: true

              # Installation details
              - column:
                  name: installation_method
                  type: VARCHAR(64)
                  constraints:
                    nullable: true

              - column:
                  name: cable_pathway
                  type: VARCHAR(128)
                  constraints:
                    nullable: true

              # Testing and certification
              - column:
                  name: tested
                  type: BOOLEAN
                  defaultValueBoolean: false
                  constraints:
                    nullable: true

              - column:
                  name: test_date
                  type: DATE
                  constraints:
                    nullable: true

              - column:
                  name: test_result
                  type: VARCHAR(32)
                  constraints:
                    nullable: true

              - column:
                  name: test_notes
                  type: VARCHAR(512)
                  constraints:
                    nullable: true

              # Documentation
              - column:
                  name: cable_id
                  type: VARCHAR(64)
                  constraints:
                    nullable: true

              - column:
                  name: circuit_id
                  type: VARCHAR(64)
                  constraints:
                    nullable: true

              - column:
                  name: installation_notes
                  type: VARCHAR(1024)
                  constraints:
                    nullable: true

              # Location references
              - column:
                  name: start_location_id
                  type: UUID
                  constraints:
                    nullable: true

              - column:
                  name: end_location_id
                  type: UUID
                  constraints:
                    nullable: true

        # Foreign key for cable_model_id
        - addForeignKeyConstraint:
            baseTableName: components
            baseColumnNames: cable_model_id
            constraintName: fk_cable_model
            referencedTableName: cable_models
            referencedColumnNames: id
            onDelete: RESTRICT

        # Foreign key for start_location_id
        - addForeignKeyConstraint:
            baseTableName: components
            baseColumnNames: start_location_id
            constraintName: fk_cable_start_location
            referencedTableName: locations
            referencedColumnNames: id
            onDelete: SET NULL

        # Foreign key for end_location_id
        - addForeignKeyConstraint:
            baseTableName: components
            baseColumnNames: end_location_id
            constraintName: fk_cable_end_location
            referencedTableName: locations
            referencedColumnNames: id
            onDelete: SET NULL

        # Indexes
        - createIndex:
            tableName: components
            indexName: idx_component_cable_model_id
            columns:
              - column:
                  name: cable_model_id

        - createIndex:
            tableName: components
            indexName: idx_component_start_location_id
            columns:
              - column:
                  name: start_location_id

        - createIndex:
            tableName: components
            indexName: idx_component_end_location_id
            columns:
              - column:
                  name: end_location_id

        - createIndex:
            tableName: components
            indexName: idx_component_cable_id
            columns:
              - column:
                  name: cable_id

        - createIndex:
            tableName: components
            indexName: idx_component_circuit_id
            columns:
              - column:
                  name: circuit_id
        ### Cable run section ends ###

        - addUniqueConstraint:
            tableName: components
            columnNames: manufacturer, serial_number
            constraintName: uk_manufacturer_serial

        - createIndex:
            tableName: components
            indexName: idx_component_class
            columns:
              - column:
                  name: component_class
        - createIndex:
            tableName: components
            indexName: idx_component_serial_number
            columns:
              - column:
                  name: serial_number

        - addForeignKeyConstraint:
            baseTableName: components
            baseColumnNames: component_status_id
            constraintName: fk_component_status
            referencedTableName: component_statuses_catalog
            referencedColumnNames: id
            onDelete: RESTRICT
        - createIndex:
            tableName: components
            indexName: idx_component_status_id
            columns:
              - column:
                  name: component_status_id

        - addForeignKeyConstraint:
            baseTableName: components
            baseColumnNames: component_type_id
            constraintName: fk_component_type
            referencedTableName: component_types_catalog
            referencedColumnNames: id
            onDelete: RESTRICT
        - createIndex:
            tableName: components
            indexName: idx_component_type_id
            columns:
              - column:
                  name: component_type_id

        - addForeignKeyConstraint:
            baseTableName: components
            baseColumnNames: component_nature_id
            constraintName: fk_component_nature
            referencedTableName: component_natures_catalog
            referencedColumnNames: id
            onDelete: RESTRICT
        - createIndex:
            tableName: components
            indexName: idx_component_nature_id
            columns:
              - column:
                  name: component_nature_id

        - addForeignKeyConstraint:
            baseTableName: components
            baseColumnNames: installation_id
            constraintName: fk_component_installation
            referencedTableName: installations
            referencedColumnNames: id
            onDelete: SET NULL
        - createIndex:
            tableName: components
            indexName: idx_component_installation_id
            columns:
              - column:
                  name: installation_id

        - addForeignKeyConstraint:
            baseTableName: components
            baseColumnNames: parent_component_id
            constraintName: fk_component_parent
            referencedTableName: components
            referencedColumnNames: id
            onDelete: SET NULL
        - createIndex:
            tableName: components
            indexName: idx_component_parent_id
            columns:
              - column:
                  name: parent_component_id

        - createIndex:
            tableName: components
            indexName: idx_component_status_type
            columns:
              - column:
                  name: component_status_id
              - column:
                  name: component_type_id
        - createIndex:
            tableName: components
            indexName: idx_component_next_maintenance
            columns:
              - column:
                  name: next_maintenance_date
            where: "next_maintenance_date IS NOT NULL"
        - createIndex:
            tableName: components
            indexName: idx_component_manufacturer_model
            columns:
              - column:
                  name: manufacturer
              - column:
                  name: model